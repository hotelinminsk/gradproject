<!doctype html> <html lang="en"> <head> <meta charset="utf-8" /> <title>Admin Login Test</title> <meta name="viewport" content="width=device-width,initial-scale=1" /> <style> body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 1.5rem; } h1 { font-size: 1.25rem; } fieldset { border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; } label { display: block; margin: .25rem 0 .15rem; font-weight: 600; } input, select { width: 100%; padding: .5rem; margin-bottom: .5rem; } button { padding: .5rem .75rem; cursor: pointer; } .row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; } .log { white-space: pre-wrap; border: 1px solid #eee; background: #fafafa; padding: .75rem; } small { color: #666; } </style> </head> <body> <h1>Admin Login Test</h1> <fieldset> <legend>Endpoint</legend> <label for="endpoint">Login Route</label> <select id="endpoint"> <option value="/api/admin/auth/login">/api/admin/auth/login</option> <option value="/api/auth/admin/login">/api/auth/admin/login</option> </select> <small>Pick the one you implemented. If unsure, try both.</small> </fieldset> <fieldset> <legend>Admin Login</legend> <label for="email">Email</label> <input id="email" type="email" placeholder="admin@gtu.edu.tr" /> <label for="password">Password</label> <input id="password" type="password" placeholder="ChangeME!123" /> <label for="adminkey">X-Admin-Key (optional)</label> <input id="adminkey" type="text" placeholder="Only if login requires the header" /> <button id="btnLogin">Login as Admin</button> </fieldset> <fieldset> <legend>Result</legend> <div class="row"> <div> <strong>JWT</strong> <div id="jwt" class="log"></div> </div> <div> <strong>Claims</strong> <div id="claims" class="log"></div> </div> </div> <div> <strong>Raw Response</strong> <div id="resp" class="log"></div> </div> </fieldset> <fieldset> <legend>Create Teacher Invite (requires Admin JWT + X-Admin-Key)</legend> <label for="expires">ExpiresAt (UTC, optional)</label> <input id="expires" type="datetime-local" /> <label for="maxuses">MaxUses (optional)</label> <input id="maxuses" type="number" min="1" /> <label for="domain">EmailDomain (optional, e.g., gtu.edu.tr)</label> <input id="domain" type="text" /> <button id="btnInvite">Create Invite</button> <div> <strong>Invite Response</strong> <div id="inviteResp" class="log"></div> </div> </fieldset> <script> const fmt = (x) => typeof x === 'string' ? x : JSON.stringify(x, null, 2); const el = (id) => document.getElementById(id); function decodeJwt(token) { try { const parts = token.split('.'); if (parts.length !== 3) return { error: 'Not a JWT' }; const b64 = parts[1].replace(/-/g, '+').replace(/_/g, '/'); const json = atob(b64); return JSON.parse(json); } catch (e) { return { error: 'Decode failed', detail: String(e) }; } } async function adminLogin() { const endpoint = el('endpoint').value; const email = el('email').value.trim(); const password = el('password').value; const adminKey = el('adminkey').value.trim(); el('resp').textContent = ''; el('jwt').textContent = ''; el('claims').textContent = ''; const headers = { 'Content-Type': 'application/json' }; if (adminKey) headers['X-Admin-Key'] = adminKey; let res, data; try { res = await fetch(endpoint, { method: 'POST', headers, body: JSON.stringify({ email, password }) }); data = await res.json(); } catch (e) { el('resp').textContent = 'Fetch error: ' + e; return; } el('resp').textContent = `Status: ${res.status}\n` + fmt(data); if (res.ok && data && data.token) { const token = data.token; localStorage.setItem('admin_jwt', token); el('jwt').textContent = token; el('claims').textContent = fmt(decodeJwt(token)); } } async function createInvite() { const token = localStorage.getItem('admin_jwt'); const adminKey = el('adminkey').value.trim(); const expires = el('expires').value; const maxuses = el('maxuses').value ? Number(el('maxuses').value) : null; const domain = el('domain').value.trim() || null; el('inviteResp').textContent = ''; if (!token) { el('inviteResp').textContent = 'No admin JWT in localStorage. Login first.'; return; } if (!adminKey) { el('inviteResp').textContent = 'X-Admin-Key is required by this endpoint.'; return; } let expiresUtc = null; if (expires) { const dt = new Date(expires); if (!isNaN(dt.getTime())) { expiresUtc = new Date(dt.getTime() - (dt.getTimezoneOffset() * 60000)).toISOString(); } } const payload = { ExpiresAtUtc: expiresUtc, MaxUses: maxuses, EmailDomain: domain }; try { const res = await fetch('/api/TeacherInvites', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token, 'X-Admin-Key': adminKey }, body: JSON.stringify(payload) }); const data = await res.json(); el('inviteResp').textContent = `Status: ${res.status}\n` + fmt(data); } catch (e) { el('inviteResp').textContent = 'Fetch error: ' + e; } } el('btnLogin').addEventListener('click', adminLogin); el('btnInvite').addEventListener('click', createInvite); </script> </body> </html>